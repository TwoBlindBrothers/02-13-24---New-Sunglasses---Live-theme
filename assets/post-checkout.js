// const order_id = '562053';
// const order_data = {
//     id: 562053,
//     shipping_address: {
//         zip: '40356',
//         country_code: 'US'
//     }
// }
// const orders = [
//     {
//         "order_number": 562053,
//         "items": [
//             {
//                 "id": 6627235070048,
//                 "title": "SHOP BLIND TIER 1 (SEPTEMBER 2022)",
//                 "price": "34.00",
//                 "line_price": "34.00",
//                 "quantity": 2,
//                 "sku": "2241139728296",
//                 "grams": 408,
//                 "properties": [
//                     [
//                         "_shopblind",
//                         "true"
//                     ]
//                 ],
//                 "vendor": "Two Blind Brothers",
//                 "requires_shipping": true,
//                 "applied_discounts": [],
//                 "tax_lines": [
//                     {
//                         "tax_line": {
//                             "title": "IL STATE TAX",
//                             "price": "0.00",
//                             "rate": 0,
//                             "price_set": {
//                                 "shop_money": {
//                                     "amount": "0.00",
//                                     "currency_code": "USD"
//                                 },
//                                 "presentment_money": {
//                                     "amount": "0.00",
//                                     "currency_code": "USD"
//                                 }
//                             }
//                         }
//                     }
//                 ],
//                 "taxable": true,
//                 "gift_card": false,
//                 "variant_id": 39543450861664,
//                 "variant": {
//                     "id": 39543450861664,
//                     "product_id": 6627235070048,
//                     "title": "Default Title",
//                     "price": "34.00",
//                     "sku": "2130194302860100675296106",
//                     "position": 1,
//                     "inventory_policy": "continue",
//                     "compare_at_price": "",
//                     "fulfillment_service": "manual",
//                     "inventory_management": "shopify",
//                     "option1": "Default Title",
//                     "option2": null,
//                     "option3": null,
//                     "created_at": "2022-08-16T09:47:20-04:00",
//                     "updated_at": "2022-09-20T16:36:35-04:00",
//                     "taxable": true,
//                     "barcode": "2130194302860100675296106",
//                     "grams": 408,
//                     "image_id": 28979874529376,
//                     "weight": 0.9,
//                     "weight_unit": "lb",
//                     "inventory_quantity": 7,
//                     "old_inventory_quantity": 7,
//                     "tax_code": "",
//                     "requires_shipping": true
//                 },
//                 "url": "/products/shop-blind-tier-1-september-2022?variant=39543450861664",
//                 "product": {
//                     "id": 6627235070048,
//                     "title": "SHOP BLIND TIER 1 (AUGUST 2022)",
//                     "body_html": "",
//                     "vendor": "Two Blind Brothers",
//                     "product_type": "shopblind",
//                     "created_at": "2022-08-16T09:47:20-04:00",
//                     "handle": "shop-blind-tier-1-august-2022",
//                     "updated_at": "2022-09-20T16:40:54-04:00",
//                     "published_at": "2022-09-20T13:07:36-04:00",
//                     "template_suffix": "shopblind",
//                     "published_scope": "web",
//                     "tags": "",
//                     "variants": [
//                         {
//                             "id": 39529649602656,
//                             "product_id": 6623003377760,
//                             "title": "Default Title",
//                             "price": "34.00",
//                             "sku": "2130194302860100675296106",
//                             "position": 1,
//                             "inventory_policy": "continue",
//                             "compare_at_price": "",
//                             "fulfillment_service": "manual",
//                             "inventory_management": "shopify",
//                             "option1": "Default Title",
//                             "option2": null,
//                             "option3": null,
//                             "created_at": "2022-08-16T09:47:20-04:00",
//                             "updated_at": "2022-09-20T16:36:35-04:00",
//                             "taxable": true,
//                             "barcode": "2130194302860100675296106",
//                             "grams": 408,
//                             "image_id": 28979874529376,
//                             "weight": 0.9,
//                             "weight_unit": "lb",
//                             "inventory_quantity": 7,
//                             "old_inventory_quantity": 7,
//                             "tax_code": "",
//                             "requires_shipping": true
//                         }
//                     ],
//                     "options": [
//                         {
//                             "id": 8515351117920,
//                             "product_id": 6623003377760,
//                             "name": "Title",
//                             "position": 1,
//                             "values": [
//                                 "Default Title"
//                             ]
//                         }
//                     ],
//                     "images": [
//                         {
//                             "id": 28979874529376,
//                             "product_id": 6623003377760,
//                             "position": 1,
//                             "created_at": "2022-08-16T09:47:22-04:00",
//                             "updated_at": "2022-08-16T09:47:22-04:00",
//                             "alt": null,
//                             "width": 1080,
//                             "height": 1080,
//                             "src": "https://cdn.shopify.com/s/files/1/1330/8707/products/QUESTIONMARKICON_c4a6222e-9a8c-44f3-a907-cc82a8aedac5.png?v=1660657642",
//                             "variant_ids": [
//                                 39529649602656
//                             ]
//                         }
//                     ],
//                     "image": {
//                         "id": 28979874529376,
//                         "product_id": 6623003377760,
//                         "position": 1,
//                         "created_at": "2022-08-16T09:47:22-04:00",
//                         "updated_at": "2022-08-16T09:47:22-04:00",
//                         "alt": null,
//                         "width": 1080,
//                         "height": 1080,
//                         "src": "https://cdn.shopify.com/s/files/1/1330/8707/products/QUESTIONMARKICON_c4a6222e-9a8c-44f3-a907-cc82a8aedac5.png?v=1660657642",
//                         "variant_ids": [
//                             39529649602656
//                         ]
//                     }
//                 },
//                 "fulfillment": {
//                     "id": 4056813699168,
//                     "order_id": 4448259113056,
//                     "status": "success",
//                     "created_at": "2022-09-20T14:15:07-04:00",
//                     "service": "manual",
//                     "updated_at": "2022-09-20T14:15:07-04:00",
//                     "tracking_company": "DHL",
//                     "shipment_status": null,
//                     "location_id": 60897263712,
//                     "line_items": [
//                         {
//                             "id": 11321863864416,
//                             "variant_id": 39529649602656,
//                             "title": "SHOP BLIND TIER 1 (AUGUST 2022)",
//                             "quantity": 1,
//                             "sku": "2130194302860100675296106",
//                             "variant_title": "",
//                             "vendor": "Two Blind Brothers",
//                             "fulfillment_service": "manual",
//                             "product_id": 6623003377760,
//                             "requires_shipping": true,
//                             "taxable": true,
//                             "gift_card": false,
//                             "name": "SHOP BLIND TIER 1 (AUGUST 2022)",
//                             "variant_inventory_management": "shopify",
//                             "properties": [
//                                 {
//                                     "name": "_shopblind",
//                                     "value": "true"
//                                 }
//                             ],
//                             "product_exists": true,
//                             "fulfillable_quantity": 0,
//                             "grams": 408,
//                             "price": "34.00",
//                             "total_discount": "0.00",
//                             "fulfillment_status": "fulfilled",
//                             "pre_tax_price": "34.00",
//                             "price_set": {
//                                 "shop_money": {
//                                     "amount": "34.00",
//                                     "currency_code": "USD"
//                                 },
//                                 "presentment_money": {
//                                     "amount": "34.00",
//                                     "currency_code": "USD"
//                                 }
//                             },
//                             "pre_tax_price_set": {
//                                 "shop_money": {
//                                     "amount": "34.00",
//                                     "currency_code": "USD"
//                                 },
//                                 "presentment_money": {
//                                     "amount": "34.00",
//                                     "currency_code": "USD"
//                                 }
//                             },
//                             "total_discount_set": {
//                                 "shop_money": {
//                                     "amount": "0.00",
//                                     "currency_code": "USD"
//                                 },
//                                 "presentment_money": {
//                                     "amount": "0.00",
//                                     "currency_code": "USD"
//                                 }
//                             },
//                             "discount_allocations": [],
//                             "duties": [],
//                             "tax_lines": [
//                                 {
//                                     "title": "IL STATE TAX",
//                                     "price": "0.00",
//                                     "rate": 0,
//                                     "price_set": {
//                                         "shop_money": {
//                                             "amount": "0.00",
//                                             "currency_code": "USD"
//                                         },
//                                         "presentment_money": {
//                                             "amount": "0.00",
//                                             "currency_code": "USD"
//                                         }
//                                     }
//                                 }
//                             ],
//                             "origin_location": {
//                                 "id": 2867852607584,
//                                 "country_code": "US",
//                                 "province_code": "NJ",
//                                 "name": "Two Blind Brothers",
//                                 "address1": "110 Amor Avenue",
//                                 "address2": "",
//                                 "city": "Carlstadt",
//                                 "zip": "07072"
//                             }
//                         }
//                     ],
//                     "tracking_number": "9274890223367519549980",
//                     "tracking_numbers": [
//                         "9274890223367519549980"
//                     ],
//                     "tracking_url": "https://www.dhl.com/us-en/home/tracking/tracking-express.html?submit=1&tracking-id=9274890223367519549980",
//                     "tracking_urls": [
//                         "https://www.dhl.com/us-en/home/tracking/tracking-express.html?submit=1&tracking-id=9274890223367519549980"
//                     ],
//                     "receipt": {},
//                     "name": "#562057.1"
//                 }
//             }
//         ]
//     }
// ]

// const items = [
//     {
//         "id": 6627235070048,
//         "title": "SHOP BLIND TIER 1 (SEPTEMBER 2022)",
//         "price": "34.00",
//         "line_price": "34.00",
//         "quantity": 3,
//         "sku": "2241139728296",
//         "grams": 408,
//         "properties": [
//             [
//                 "_shopblind",
//                 "true"
//             ]
//         ],
//         "vendor": "Two Blind Brothers",
//         "requires_shipping": true,
//         "applied_discounts": [],
//         "tax_lines": [
//             {
//                 "tax_line": {
//                     "title": "IL STATE TAX",
//                     "price": "0.00",
//                     "rate": 0,
//                     "price_set": {
//                         "shop_money": {
//                             "amount": "0.00",
//                             "currency_code": "USD"
//                         },
//                         "presentment_money": {
//                             "amount": "0.00",
//                             "currency_code": "USD"
//                         }
//                     }
//                 }
//             }
//         ],
//         "taxable": true,
//         "gift_card": false,
//         "variant_id": 39543450861664,
//         "variant": {
//             "id": 39543450861664,
//             "product_id": 6623003377760,
//             "title": "Default Title",
//             "price": "34.00",
//             "sku": "2130194302860100675296106",
//             "position": 1,
//             "inventory_policy": "continue",
//             "compare_at_price": "",
//             "fulfillment_service": "manual",
//             "inventory_management": "shopify",
//             "option1": "Default Title",
//             "option2": null,
//             "option3": null,
//             "created_at": "2022-08-16T09:47:20-04:00",
//             "updated_at": "2022-09-20T16:36:35-04:00",
//             "taxable": true,
//             "barcode": "2130194302860100675296106",
//             "grams": 408,
//             "image_id": 28979874529376,
//             "weight": 0.9,
//             "weight_unit": "lb",
//             "inventory_quantity": 7,
//             "old_inventory_quantity": 7,
//             "tax_code": "",
//             "requires_shipping": true
//         },
//         "url": "/products/shop-blind-tier-1-september-2022?variant=39543450861664",
//         "product": {
//             "id": 6623003377760,
//             "title": "SHOP BLIND TIER 1 (AUGUST 2022)",
//             "body_html": "",
//             "vendor": "Two Blind Brothers",
//             "product_type": "shopblind",
//             "created_at": "2022-08-16T09:47:20-04:00",
//             "handle": "shop-blind-tier-1-august-2022",
//             "updated_at": "2022-09-20T16:40:54-04:00",
//             "published_at": "2022-09-20T13:07:36-04:00",
//             "template_suffix": "shopblind",
//             "published_scope": "web",
//             "tags": "",
//             "variants": [
//                 {
//                     "id": 39529649602656,
//                     "product_id": 6627235070048,
//                     "title": "Default Title",
//                     "price": "34.00",
//                     "sku": "2130194302860100675296106",
//                     "position": 1,
//                     "inventory_policy": "continue",
//                     "compare_at_price": "",
//                     "fulfillment_service": "manual",
//                     "inventory_management": "shopify",
//                     "option1": "Default Title",
//                     "option2": null,
//                     "option3": null,
//                     "created_at": "2022-08-16T09:47:20-04:00",
//                     "updated_at": "2022-09-20T16:36:35-04:00",
//                     "taxable": true,
//                     "barcode": "2130194302860100675296106",
//                     "grams": 408,
//                     "image_id": 28979874529376,
//                     "weight": 0.9,
//                     "weight_unit": "lb",
//                     "inventory_quantity": 7,
//                     "old_inventory_quantity": 7,
//                     "tax_code": "",
//                     "requires_shipping": true
//                 }
//             ],
//             "options": [
//                 {
//                     "id": 8515351117920,
//                     "product_id": 6623003377760,
//                     "name": "Title",
//                     "position": 1,
//                     "values": [
//                         "Default Title"
//                     ]
//                 }
//             ],
//             "images": [
//                 {
//                     "id": 28979874529376,
//                     "product_id": 6623003377760,
//                     "position": 1,
//                     "created_at": "2022-08-16T09:47:22-04:00",
//                     "updated_at": "2022-08-16T09:47:22-04:00",
//                     "alt": null,
//                     "width": 1080,
//                     "height": 1080,
//                     "src": "https://cdn.shopify.com/s/files/1/1330/8707/products/QUESTIONMARKICON_c4a6222e-9a8c-44f3-a907-cc82a8aedac5.png?v=1660657642",
//                     "variant_ids": [
//                         39529649602656
//                     ]
//                 }
//             ],
//             "image": {
//                 "id": 28979874529376,
//                 "product_id": 6623003377760,
//                 "position": 1,
//                 "created_at": "2022-08-16T09:47:22-04:00",
//                 "updated_at": "2022-08-16T09:47:22-04:00",
//                 "alt": null,
//                 "width": 1080,
//                 "height": 1080,
//                 "src": "https://cdn.shopify.com/s/files/1/1330/8707/products/QUESTIONMARKICON_c4a6222e-9a8c-44f3-a907-cc82a8aedac5.png?v=1660657642",
//                 "variant_ids": [
//                     39529649602656
//                 ]
//             }
//         },
//         "fulfillment": {
//             "id": 4056813699168,
//             "order_id": 4448259113056,
//             "status": "success",
//             "created_at": "2022-09-20T14:15:07-04:00",
//             "service": "manual",
//             "updated_at": "2022-09-20T14:15:07-04:00",
//             "tracking_company": "DHL",
//             "shipment_status": null,
//             "location_id": 60897263712,
//             "line_items": [
//                 {
//                     "id": 11321863864416,
//                     "variant_id": 39529649602656,
//                     "title": "SHOP BLIND TIER 1 (AUGUST 2022)",
//                     "quantity": 1,
//                     "sku": "2130194302860100675296106",
//                     "variant_title": "",
//                     "vendor": "Two Blind Brothers",
//                     "fulfillment_service": "manual",
//                     "product_id": 6623003377760,
//                     "requires_shipping": true,
//                     "taxable": true,
//                     "gift_card": false,
//                     "name": "SHOP BLIND TIER 1 (AUGUST 2022)",
//                     "variant_inventory_management": "shopify",
//                     "properties": [
//                         {
//                             "name": "_shopblind",
//                             "value": "true"
//                         }
//                     ],
//                     "product_exists": true,
//                     "fulfillable_quantity": 0,
//                     "grams": 408,
//                     "price": "34.00",
//                     "total_discount": "0.00",
//                     "fulfillment_status": "fulfilled",
//                     "pre_tax_price": "34.00",
//                     "price_set": {
//                         "shop_money": {
//                             "amount": "34.00",
//                             "currency_code": "USD"
//                         },
//                         "presentment_money": {
//                             "amount": "34.00",
//                             "currency_code": "USD"
//                         }
//                     },
//                     "pre_tax_price_set": {
//                         "shop_money": {
//                             "amount": "34.00",
//                             "currency_code": "USD"
//                         },
//                         "presentment_money": {
//                             "amount": "34.00",
//                             "currency_code": "USD"
//                         }
//                     },
//                     "total_discount_set": {
//                         "shop_money": {
//                             "amount": "0.00",
//                             "currency_code": "USD"
//                         },
//                         "presentment_money": {
//                             "amount": "0.00",
//                             "currency_code": "USD"
//                         }
//                     },
//                     "discount_allocations": [],
//                     "duties": [],
//                     "tax_lines": [
//                         {
//                             "title": "IL STATE TAX",
//                             "price": "0.00",
//                             "rate": 0,
//                             "price_set": {
//                                 "shop_money": {
//                                     "amount": "0.00",
//                                     "currency_code": "USD"
//                                 },
//                                 "presentment_money": {
//                                     "amount": "0.00",
//                                     "currency_code": "USD"
//                                 }
//                             }
//                         }
//                     ],
//                     "origin_location": {
//                         "id": 2867852607584,
//                         "country_code": "US",
//                         "province_code": "NJ",
//                         "name": "Two Blind Brothers",
//                         "address1": "110 Amor Avenue",
//                         "address2": "",
//                         "city": "Carlstadt",
//                         "zip": "07072"
//                     }
//                 }
//             ],
//             "tracking_number": "9274890223367519549980",
//             "tracking_numbers": [
//                 "9274890223367519549980"
//             ],
//             "tracking_url": "https://www.dhl.com/us-en/home/tracking/tracking-express.html?submit=1&tracking-id=9274890223367519549980",
//             "tracking_urls": [
//                 "https://www.dhl.com/us-en/home/tracking/tracking-express.html?submit=1&tracking-id=9274890223367519549980"
//             ],
//             "receipt": {},
//             "name": "#562057.1"
//         }
//     },
    // {
    //     "id": 6627235135584,
    //     "title": "SHOP BLIND TIER 2 (SEPTEMBER 2022)",
    //     "price": "69.00",
    //     "line_price": "69.00",
    //     "quantity": 2,
    //     "sku": "22412322029756",
    //     "grams": 408,
    //     "properties": [
    //         [
    //             "_shopblind",
    //             "true"
    //         ]
    //     ],
    //     "vendor": "Two Blind Brothers",
    //     "requires_shipping": true,
    //     "applied_discounts": [],
    //     "tax_lines": [
    //         {
    //             "tax_line": {
    //                 "title": "IL STATE TAX",
    //                 "price": "0.00",
    //                 "rate": 0,
    //                 "price_set": {
    //                     "shop_money": {
    //                         "amount": "0.00",
    //                         "currency_code": "USD"
    //                     },
    //                     "presentment_money": {
    //                         "amount": "0.00",
    //                         "currency_code": "USD"
    //                     }
    //                 }
    //             }
    //         }
    //     ],
    //     "taxable": true,
    //     "gift_card": false,
    //     "variant_id": 39543450959968,
    //     "variant": {
    //         "id": 39543450959968,
    //         "product_id": 6627235135584,
    //         "title": "Default Title",
    //         "price": "34.00",
    //         "sku": "2130194302860100675296106",
    //         "position": 1,
    //         "inventory_policy": "continue",
    //         "compare_at_price": "",
    //         "fulfillment_service": "manual",
    //         "inventory_management": "shopify",
    //         "option1": "Default Title",
    //         "option2": null,
    //         "option3": null,
    //         "created_at": "2022-08-16T09:47:20-04:00",
    //         "updated_at": "2022-09-20T16:36:35-04:00",
    //         "taxable": true,
    //         "barcode": "2130194302860100675296106",
    //         "grams": 408,
    //         "image_id": 28979874529376,
    //         "weight": 0.9,
    //         "weight_unit": "lb",
    //         "inventory_quantity": 7,
    //         "old_inventory_quantity": 7,
    //         "tax_code": "",
    //         "requires_shipping": true
    //     },
    //     "url": "/products/shop-blind-tier-1-september-2022?variant=39543450861664",
    //     "product": {
    //         "id": 6623003377760,
    //         "title": "SHOP BLIND TIER 1 (AUGUST 2022)",
    //         "body_html": "",
    //         "vendor": "Two Blind Brothers",
    //         "product_type": "shopblind",
    //         "created_at": "2022-08-16T09:47:20-04:00",
    //         "handle": "shop-blind-tier-1-august-2022",
    //         "updated_at": "2022-09-20T16:40:54-04:00",
    //         "published_at": "2022-09-20T13:07:36-04:00",
    //         "template_suffix": "shopblind",
    //         "published_scope": "web",
    //         "tags": "",
    //         "variants": [
    //             {
    //                 "id": 39529649602656,
    //                 "product_id": 6627235070048,
    //                 "title": "Default Title",
    //                 "price": "34.00",
    //                 "sku": "2130194302860100675296106",
    //                 "position": 1,
    //                 "inventory_policy": "continue",
    //                 "compare_at_price": "",
    //                 "fulfillment_service": "manual",
    //                 "inventory_management": "shopify",
    //                 "option1": "Default Title",
    //                 "option2": null,
    //                 "option3": null,
    //                 "created_at": "2022-08-16T09:47:20-04:00",
    //                 "updated_at": "2022-09-20T16:36:35-04:00",
    //                 "taxable": true,
    //                 "barcode": "2130194302860100675296106",
    //                 "grams": 408,
    //                 "image_id": 28979874529376,
    //                 "weight": 0.9,
    //                 "weight_unit": "lb",
    //                 "inventory_quantity": 7,
    //                 "old_inventory_quantity": 7,
    //                 "tax_code": "",
    //                 "requires_shipping": true
    //             }
    //         ],
    //         "options": [
    //             {
    //                 "id": 8515351117920,
    //                 "product_id": 6623003377760,
    //                 "name": "Title",
    //                 "position": 1,
    //                 "values": [
    //                     "Default Title"
    //                 ]
    //             }
    //         ],
    //         "images": [
    //             {
    //                 "id": 28979874529376,
    //                 "product_id": 6623003377760,
    //                 "position": 1,
    //                 "created_at": "2022-08-16T09:47:22-04:00",
    //                 "updated_at": "2022-08-16T09:47:22-04:00",
    //                 "alt": null,
    //                 "width": 1080,
    //                 "height": 1080,
    //                 "src": "https://cdn.shopify.com/s/files/1/1330/8707/products/QUESTIONMARKICON_c4a6222e-9a8c-44f3-a907-cc82a8aedac5.png?v=1660657642",
    //                 "variant_ids": [
    //                     39529649602656
    //                 ]
    //             }
    //         ],
    //         "image": {
    //             "id": 28979874529376,
    //             "product_id": 6623003377760,
    //             "position": 1,
    //             "created_at": "2022-08-16T09:47:22-04:00",
    //             "updated_at": "2022-08-16T09:47:22-04:00",
    //             "alt": null,
    //             "width": 1080,
    //             "height": 1080,
    //             "src": "https://cdn.shopify.com/s/files/1/1330/8707/products/QUESTIONMARKICON_c4a6222e-9a8c-44f3-a907-cc82a8aedac5.png?v=1660657642",
    //             "variant_ids": [
    //                 39529649602656
    //             ]
    //         }
    //     },
    //     "fulfillment": {
    //         "id": 4056813699168,
    //         "order_id": 4448259113056,
    //         "status": "success",
    //         "created_at": "2022-09-20T14:15:07-04:00",
    //         "service": "manual",
    //         "updated_at": "2022-09-20T14:15:07-04:00",
    //         "tracking_company": "DHL",
    //         "shipment_status": null,
    //         "location_id": 60897263712,
    //         "line_items": [
    //             {
    //                 "id": 11321863864416,
    //                 "variant_id": 39529649602656,
    //                 "title": "SHOP BLIND TIER 1 (AUGUST 2022)",
    //                 "quantity": 1,
    //                 "sku": "2130194302860100675296106",
    //                 "variant_title": "",
    //                 "vendor": "Two Blind Brothers",
    //                 "fulfillment_service": "manual",
    //                 "product_id": 6623003377760,
    //                 "requires_shipping": true,
    //                 "taxable": true,
    //                 "gift_card": false,
    //                 "name": "SHOP BLIND TIER 1 (AUGUST 2022)",
    //                 "variant_inventory_management": "shopify",
    //                 "properties": [
    //                     {
    //                         "name": "_shopblind",
    //                         "value": "true"
    //                     }
    //                 ],
    //                 "product_exists": true,
    //                 "fulfillable_quantity": 0,
    //                 "grams": 408,
    //                 "price": "34.00",
    //                 "total_discount": "0.00",
    //                 "fulfillment_status": "fulfilled",
    //                 "pre_tax_price": "34.00",
    //                 "price_set": {
    //                     "shop_money": {
    //                         "amount": "34.00",
    //                         "currency_code": "USD"
    //                     },
    //                     "presentment_money": {
    //                         "amount": "34.00",
    //                         "currency_code": "USD"
    //                     }
    //                 },
    //                 "pre_tax_price_set": {
    //                     "shop_money": {
    //                         "amount": "34.00",
    //                         "currency_code": "USD"
    //                     },
    //                     "presentment_money": {
    //                         "amount": "34.00",
    //                         "currency_code": "USD"
    //                     }
    //                 },
    //                 "total_discount_set": {
    //                     "shop_money": {
    //                         "amount": "0.00",
    //                         "currency_code": "USD"
    //                     },
    //                     "presentment_money": {
    //                         "amount": "0.00",
    //                         "currency_code": "USD"
    //                     }
    //                 },
    //                 "discount_allocations": [],
    //                 "duties": [],
    //                 "tax_lines": [
    //                     {
    //                         "title": "IL STATE TAX",
    //                         "price": "0.00",
    //                         "rate": 0,
    //                         "price_set": {
    //                             "shop_money": {
    //                                 "amount": "0.00",
    //                                 "currency_code": "USD"
    //                             },
    //                             "presentment_money": {
    //                                 "amount": "0.00",
    //                                 "currency_code": "USD"
    //                             }
    //                         }
    //                     }
    //                 ],
    //                 "origin_location": {
    //                     "id": 2867852607584,
    //                     "country_code": "US",
    //                     "province_code": "NJ",
    //                     "name": "Two Blind Brothers",
    //                     "address1": "110 Amor Avenue",
    //                     "address2": "",
    //                     "city": "Carlstadt",
    //                     "zip": "07072"
    //                 }
    //             }
    //         ],
    //         "tracking_number": "9274890223367519549980",
    //         "tracking_numbers": [
    //             "9274890223367519549980"
    //         ],
    //         "tracking_url": "https://www.dhl.com/us-en/home/tracking/tracking-express.html?submit=1&tracking-id=9274890223367519549980",
    //         "tracking_urls": [
    //             "https://www.dhl.com/us-en/home/tracking/tracking-express.html?submit=1&tracking-id=9274890223367519549980"
    //         ],
    //         "receipt": {},
    //         "name": "#562057.1"
    //     }
    // }
// ]

// const popupModal = `
// <div id="post-checkout-wrapper" role="dialog" labelledby="upgrade-order" aria-modal="true" aria-hidden="true">
//     <div id="sb-options-wrapper" class="">
//         <div id="sb-options-container">
//             <form id="sb-options-form">
//                 <div id="sb-options-scroll">
//                     <div id="sb-options">
//                         <div id="sb-options-header" class="text-center">
//                             <h2 id="upgrade-order" class="text-uppercase text-center">Your order is all set!</h2>
//                             <p>If you'd like to personalize your order, select from the following options</p>
//                         </div>
//                         <div id="sb-items-wrapper">
//                         </div>
//                     </div>
//                 </div>
//                 <a class="close-modal" href="#close-modal" name="Close modal">
//                     <svg width="13px" height="13px" viewBox="0 0 13 13" version="1.1" xmlns="http://www.w3.org/2000/svg">
//                         <g id="Welcome" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
//                             <g id="Desktop" transform="translate(-496.000000, -116.000000)" fill="#000000">
//                                 <polygon id="Fill-1" points="507.369 116 502.502 120.867 497.635 116 496 117.635 500.867 122.503 496 127.37 497.635 129.004 502.502 124.137 507.369 129.004 509.004 127.37 504.137 122.503 509.004 117.635">
//                                 </polygon>
//                             </g>
//                         </g>
//                     </svg>
//                 </a>
//                 <a class="no-thanks" href="#no-thanks">No Thanks</a>
//                 <button type="submit" id="submit-sb-order">Submit</button>
//             </form>
//         </div>
//     </div>
// </div>`


// Find all Shop Blind items in order
const sbItems = items.filter( item => {
    return item.product.product_type === 'shopblind'
})

const nonSbItems = items.filter( item => {
    return item.product.product_type !== 'shopblind'
})

let cart = {}

// create new object of items split by quantity. Ie. If item quantity == 2, create 2 of these items
sbItems.forEach( item => {
    for ( let i = 0; i < item.quantity; i++ ) {
        cart[`${item.product.id}-${i}`] = {
            ...item,
            options_with_values: item.options_with_values || [],
            quantity: 1,
            variant_id: item.variant_id
        }
    }
})

// Create array of SKUs for all Shop Blind items in order
const sbSkus = sbItems.map( item => item.sku )

let hasUpgrade = false
// Determine if the customer has ordered the same SKU in the past.
const repeatOrders = orders.filter( order => {
    // Omit the current order
    if ( order.order_number === order_number ) return false
    return order.items.filter( item => sbSkus.includes(item.sku ) ).length ? true : false
})

if ( repeatOrders.length || customer_tags.includes('SHOP BLIND (HOLIDAY 2021)') ) {
    hasUpgrade = true
}

// The customer HAS ordered the same SKU in the past
$(document).ready( function () {
    // Send original items to processor. This will start a 15 minute wait time and process items if no new selections are made

    fetch('https://stagingapi.guidedogchallenge.com/api/v1/process_sb_hold', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
            // 'Content-Type': 'application/x-www-form-urlencoded',
        },
        body: JSON.stringify({ items, order_data, upgrade: hasUpgrade })
    }).then( response => {
        // console.log(response)
    })
    if ( hasUpgrade ) {
        fetch(`/cart?view=post-checkout`, {
            method: 'GET',
            headers: {
                'Content-Type': 'text/html'
            }
        })
        .then( response => response.text() )
        .then( data => { 
            $('body').append(data)
            let sbPromises = []
            sbItems.forEach( item => {
                for ( let i = 0; i < item.quantity; i++ ) {
                    sbPromises.push(new Promise((resolve, reject) => {
                        fetch(`${item.url}&view=post-checkout&index=${i}`, {
                            method: 'GET',
                            headers: {
                                'Content-Type': 'text/html'
                            }
                        })
                        .then( response => response.text() )
                        .then( data => { 
                            if ( data !== '' ) {
                                resolve(data)
                            }
                        })
                    }))
                }
            }) 
            let shouldShowModal = false
            Promise.all(sbPromises).then( sbItems => {
                sbItems.forEach( (sbItem, sbItemIndex) => {
                    const trimmedItem = sbItem.trim()
                    if ( trimmedItem !== '' || trimmedItem !== null ) {
                        // Sending index via parameters was not consistent. Replace string {item_index} with the index from this loop instead.
                        let sbItemHtml = sbItem.replaceAll('{item_index}', sbItemIndex)
                        $('#sb-items-wrapper').append(sbItemHtml)
                        shouldShowModal = true
                    }
                })
                // The return has a bunch of spaces. Look for spaces only
                const spacesOnly = /^\s*$/.test($('#sb-items-wrapper').text())
                if ( !spacesOnly ) {
                    displayModal()
                    openDialog('post-checkout-wrapper', this, 'sb-items-wrapper')
                }
            });
        })
    }    
})

const displayModal = () => {
    $('.no-thanks, .close-modal').on('click', function (e) {
        e.preventDefault()
        closeDialog(e.target);
    })
    $('#submit-sb-order').on('click', function (e) {
        e.preventDefault()
        let shouldSubmit = true
        $('.options-group').each( (oInd, options) => {
            if ( $('input:checked', options).length > 0 && $('input:checked', options).length < $('.variant-options', options).length ) {
                $('.variant-options', options).each( (gInd, group) => {
                    if ( $('input:checked', group ).length === 0 ) {
                        $('.error', group).show();
                        shouldSubmit = false
                    }
                })
            }
        })
        if ( shouldSubmit ) {
            // Find items with selected options and set options_with_values with new values
            $('.sb-item').each( (index, item) => {
                $('input:checked', item).each( (optionInd, option) => {
                    cart[`${$(option).data('product')}-${$(option).data('item-index')}`] = {
                        ...cart[`${$(option).data('product')}-${$(option).data('item-index')}`],
                        options_with_values: [
                            ...cart[`${$(option).data('product')}-${$(option).data('item-index')}`].options_with_values, 
                            { name: $(option).data('option-type'), value: $(option).val() }
                        ]
                    }
                })
            })
            let payload = []
            Object.keys(cart).forEach( cartItem => {
                let isDuplicate = false 
                // look for duplicate selections and combine into one item if it's the same.
                payload.forEach( (item, payloadIndex) => {
                    // if the options are the same and the variant is the same, combine
                    if ( JSON.stringify(item.options_with_values) === JSON.stringify(cart[cartItem].options_with_values) && item.variant_id === cart[cartItem].variant_id ) {
                        payload[payloadIndex].quantity = payload[payloadIndex].quantity + 1
                        isDuplicate = true
                        return
                    }
                })
                if ( isDuplicate ) return
                payload.push(cart[cartItem])
            })
            payload = payload.concat(nonSbItems)
            fetch('https://stagingapi.guidedogchallenge.com/api/v1/unbundle_sb_items', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                    // 'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: JSON.stringify({ items: payload, order_data, upgrade: true })
            }).then( response => {
                $('#post-checkout-failed').remove()
                if ( response.status === 200 ) {
                    $('.no-thanks').hide();
                    $('#submit-sb-order').html('Close')
                    $('#submit-sb-order').off('click').on('click', function (e) {
                        e.preventDefault()
                        closeDialog(e.target)
                    })
                    $('#sb-options').html(`
                        <h2 class="text-uppercase text-center">Thanks!</h2>
                        <p style="color: black;">Your order has been finalized</p>
                        <p style="color: black; text-transform: uppercase; font-size: .9rem; font-weight: bold;">Order #${order_data.id}</p>
                    `)
                } else {
                    $('#sb-options').html(`
                        <p id="post-checkout-failed" style="text-align: center; color: red;">Something went wrong! Please refresh and try again!</p>
                    `)
                }
            })
        }
    })
}

function handleSelectOption(option) {
    const productId = $(option).data('product')
    const currentIndex = $(option).data('select-index')
    const itemIndex = $(option).data('item-index')
    const availableOptions = []
    $(option).closest('.variant-options').find('.error').hide()
    if ( $(`#product-options-${productId}-${currentIndex + 1}-${itemIndex}`).length ) {
        $(`#product-options-${productId}-${currentIndex + 1}-${itemIndex}`).removeClass('disabled')
    }
    $(`#product-select-${productId}-${itemIndex} option`).each( (oInd, option) => {
        availableOptions.push($(option).val().split('|'))
    })
    let selectedOptions = []
    for ( let i = 0; i <= currentIndex; i++ ) {
        selectedOptions.push($(`#option-${productId}-${itemIndex}-${i} input:checked`).val())
    }

    // Only show options that correspond to the currently selected options
    $(`#product-options-group-${productId}-${itemIndex} .variant-options`).each( (selIndex, select) => {
        if ( selIndex > currentIndex ) {
            $('input', select).each( (o, option) => {
                const optionText = $(option).val().trim()
                const optionsArr = selectedOptions.concat(optionText)
                let shouldShowOption = false
                availableOptions.forEach( variant => {
                    if ( JSON.stringify(variant) == JSON.stringify(optionsArr) ) {
                        shouldShowOption = true
                    }
                })
                if ( !shouldShowOption ) {
                    //$(option).attr('disabled', !shouldShowOption)
                    $(option).parent().hide()
                } else {
                    $(option).parent().show()
                }
            })
        }
        // Unselect options below the current selected option group and remove "disabled" for next option group
        if ( selIndex > currentIndex ) {
            $(`#option-${ productId }-${itemIndex}-${selIndex} input`).attr("checked", false).trigger('change');
            if ( selIndex == currentIndex + 1 ) {
                if ( $(`#option-${productId}-${itemIndex}-${selIndex}`).length ) {
                    $(`#option-${productId}-${itemIndex}-${selIndex}`).removeClass('disabled')
                }
            }
        }
    })

    return
    // const productVariants = JSON.parse(product.variants)
    // const productId = product.productId
    // let availableOptions = []
    // $(`#product-options-wrapper-${productId} .product-options-select`).each( (s, optSel) => {
    //   availableOptions.push($(optSel).val())
    // })
  
    // const currentIndex = $(select).data('select-index')
    // let selectedOptions = []
    // console.log('curren', currentIndex)
    // $(`#product-options-wrapper-${productId} #option-select-error-${currentIndex}`).hide()
    // // Get all options selected at or above the current selector
    // for ( let i = 1; i <= currentIndex; i++ ) {
    //     selectedOptions.push($(`#select-${productId}-${i}`).val())
    // }
  
    // $(select).parent().find('.product-options-select').each( (selIndex, selectOption) => {
    //     const selectIndex = $(selectOption).data('select-index')
    //     if ( selectIndex > currentIndex ) {
    //         $('option', selectOption).each( (o, option) => {
    //             if ( o === 0 ) return
    //             const optionText = $(option).text().trim()
    //             const optionsArr = selectedOptions.concat(optionText)
    //             let shouldShowOption = false
    //             productVariants.forEach( variant => {
    //                 if ( JSON.stringify(variant.options) == JSON.stringify(optionsArr) ) {
    //                     shouldShowOption = true
    //                 }
    //             })
    //             if ( !shouldShowOption ) {
    //                 //$(option).attr('disabled', !shouldShowOption)
    //                 $(option).hide()
    //             } else {
    //                 $(option).show()
    //             }
    //         })
    //     }
    //     if ( selIndex + 1 > currentIndex ) {
    //         $(`#select-${productId}-${selIndex + 1} option:first-of-type`).prop("selected", true).trigger('change');
    //     }
    // })
    // var id = '';
    // productVariants.forEach( variant => {
    //   if ( JSON.stringify(variant.options) === JSON.stringify(availableOptions) ) {
    //     id = variant.id;
    //   }
    // })
    // const selectVal = document.getElementById(`product-select-${productId}`)
    // if (id == '') {
    //   // Variant Not Found / Unavailable
    //   selectVal.value = '';
    //   // Disable Add To Cart Button Here
    // } else if ($(`#product-select-${productId} option[value="${id}"]`).prop('disabled') == true) {
    //   // Sold Out
    //   selectVal.value = id;
    //   // Disable Add To Cart Button Here			
    // } else {
    //   selectVal.value = id;
    //   // Enable Add To Cart Button Here
    // }		
  }