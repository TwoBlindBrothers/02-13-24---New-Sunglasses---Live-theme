{% liquid
    unless grid_item_width
      assign grid_item_width = 'large--one-half medium--one-half'
    endunless
  
    assign alignment = alignment | default: 'under-image'
    assign text_layout = text_layout | default: 'left'
    assign price_decimals = price_decimals | default: true
    
    assign on_sale = false
    if product.compare_at_price > product.price
      assign on_sale = true
    endif
  
    assign sold_out = true
    if product.available
      assign sold_out = false
    endif
  
    assign product_title = product.title | replace: "Women's ", "" | replace: "Men's ", ""
  
    assign variantsFeaturedImage = ''
    for variant in product.variants
    if variant.metafields.cart_option.default_variant_add_cart == "true"
      assign variantsFeaturedImage = variant.featured_image
      break
    endif
    endfor
    assign images = product.images
  
    if product.options contains 'Color'
      assign values = product.variants.first | map: "option1" | uniq
    endif
    assign variantColor = values[0] | downcase
  
    assign found = false
    assign hoverColorHover = values[0] | downcase | append: ' hover'
    assign hoverImage = product.featured_image
    for image in images
      assign alt_downcase = image.alt | downcase
      if alt_downcase contains hoverColorHover and found == false
        assign hoverImage = image
        assign found = true
      endif
    endfor
  
    assign values = null
    assign option = product.options_with_values[0]
  %}
  
  {% capture product_subtext %}
    {% if sold_out %}
      Sold Out
    {% endif %}
  {% endcapture %}
  
  {% capture product_price %}
    {% if on_sale %}
      {% if product.price_varies %}
        {% assign sale_price = product.price | money_without_trailing_zeros %}
        </br><s style="font-weight: normal; margin-right: .25rem; opacity: .5;">{{ product.compare_at_price | money_without_trailing_zeros }}</s><span style="letter-spacing: .1rem;">{{ 'products.product.on_sale_from_html' | t: price: sale_price }}</span>
      {% else %}
        <span class="h4">{{ 'products.product.on_sale' | t }}</span>
        <span class="visually-hidden">{{ 'products.general.regular_price' | t }}</span>
        <s style="font-weight: normal; margin-right: .25rem; opacity: .5;">{{ product.compare_at_price | money_without_trailing_zeros }}</s>
        {{ product.price | money_without_trailing_zeros }}
      {% endif %}
    {% else %}
      {% if product.price_varies %}
        {% assign price = product.price | money_without_trailing_zeros %}
        <span class="h2 price">{{ product.price_min | money_without_trailing_zeros }} - {{ product.price_max | money_without_trailing_zeros }}</span>
      {% else %}
        <span class="h2 price">{{ product.price | money_without_trailing_zeros }}</span>
      {% endif %}
    {% endif %}
    {% if sold_out %}
      <br><span class="h4">{{ 'products.product.sold_out' | t }}</span>
    {% endif %}
  {% endcapture %}
  
  {% comment %}
    Show add to cart button if there is only 1 variant and it's not Title (no variant product)
  {% endcomment %}
  
  {% capture product_image %}
    {% assign found = false %}
    {% assign variant = product.variants.first %}
    {% for image in images %}
      {% assign alt_downcase = image.alt | downcase %}
      {% if alt_downcase contains variantColor and found == false %}
        <div class="default-image absolute top-0 left-0 w-full h-full">
            <span class="loader absolute top-0 left-0 flex justify-center items-center w-full h-full pointer-events-none bg-grey text-white"></span>
            <img
                loading="lazy"
                src="{{ image.src | image_url: height: 500, width: 500, crop: 'center' }}"
                width="500"
                height="500"
                alt="{{ product.title | escape }} in {{ variant.option1 }}"
                class="absolute top-0 left-0 w-full h-full object-cover rounded-[4px] md:rounded-[8px]"
            />
        </div>
        {% assign found = true %}
      {% endif %}
    {% endfor %}
  
    {% if found == false %}
        <div class="default-image absolute top-0 left-0 w-full h-full">
            <img
                loading="lazy"
                src="{{ product.featured_image.src | image_url: height: 500, width: 500, crop: 'center' }}"
                width="500"
                height="500"
                alt="{{ product.title | escape }} in {{ variant.option1 }}"
                class="absolute top-0 left-0 w-full h-full object-cover rounded-[4px] md:rounded-[8px]"
            />
            <span class="loader absolute top-0 left-0 flex justify-center items-center w-full h-full pointer-events-none bg-grey text-white"></span>
        </div>
    {% endif %}
  {% endcapture %}
  
  {% capture product_price %}
    {% if on_sale %}
      {% if product.price_varies %}
        {% assign sale_price = product.price | money %}
        {{ 'products.product.on_sale_from_html' | t: price: sale_price }}
      {% else %}
        <span class="p1">{{ 'products.product.on_sale' | t }}</span>
        <span class="visually-hidden">{{ 'products.general.regular_price' | t }}</span>
        <s style="font-weight: normal; margin-right: .25rem; opacity: .5;">{{ product.compare_at_price | money }}</s>
        {% assign formatted_price = product.price | money %}
        {% if price_decimals == false %}
          {% assign formatted_price = product.price | money_without_trailing_zeros %}
        {% endif %}
        {{ formatted_price }}
      {% endif %}
    {% else %}
      {% if product.price_varies %}
        {% assign price = product.price | money %}
        <span class="price p1 text-grey-400 font-normal">{{ product.price_min | money }} - {{ product.price_max | money }}</span>
      {% else %}
        {% assign formatted_price = product.price | money %}
        {% if price_decimals == false %}
          {% assign formatted_price = product.price | money_without_trailing_zeros %}
        {% endif %}
        <span class="ps-1">{{ formatted_price }}</span>
      {% endif %}
    {% endif %}
  {% endcapture %}
  
  <div class="reserve-product-card float-none flex flex-wrap !pl-0 {% for tag in product.tags %} filter-{{ tag }} {% endfor %}">
    <div class="flex w-full justify-center gap-4 md:gap-x-8 !mb-0{% if alignment == 'bottom' %} layout-bottom{% endif %}" data-reserve-product-card id="product-{{ product_id }}">
      <div class="reserve-product-card__wrapper w-full max-w-40 md:max-w-28 min-w-28">
        <div class="grid-image-wrapper">
            <div class="grid__image relative overflow-hidden pb-[100%] !mb-[10px] sm:!mb-2 md:!mb-0 lg:!mb-0 rounded-[4px] md:rounded-[8px]">
                <div class="hover-image absolute top-0 left-0 w-full h-full">
                    <img
                        loading="lazy"
                        src="{{ hoverImage | image_url: height: 500, width: 500, crop: 'center' }}"
                        width="500"
                        height="500"
                        alt="{{ product.title | escape }} in {{ variant.option1 }}"
                        class="grid__variant-hover lazyload absolute top-0 left-0 w-full h-full object-cover rounded-[4px] md:rounded-[8px]"
                    />
                    <span class="loader absolute top-0 left-0 flex justify-center items-center w-full h-full pointer-events-none bg-grey text-white"></span>
                </div>
        
                {{ product_image }}
  
            </div>
        </div>
  
        <select name="id" data-productid="{{ product_id }}" id="productSelect-{{ product_id }}" class="product-single__variants">
          {% for variant in product.variants %}
            {% if variant.available %}
              {% comment %}
              Note: if you use option_selection.js, your <select> tag will be overwritten, meaning what you have inside <option> will not reflect what you coded below.
              {% endcomment %}
              <option {% if variant == selected_variant %} selected="selected" {% endif %} data-sku="{{ variant.sku }}" value="{{ variant.id }}">
                {{ variant.title }} - {{ variant.price | money_with_currency }}
              </option>
            {% else %}
              <option disabled="disabled">
                {{ variant.title }} - {{ 'products.product.sold_out' | t }}
              </option>
            {% endif %}
          {% endfor %}
        </select>
      </div>
      <div class="grid__product-content w-min">
        <div class="grid__product-wrapper flex md:gap-4 w-full md:justify-between md:align-center flex-wrap sm:flex-wrap md:flex-nowrap">
            <div class="sm:shrink-0 sm:min-w-64">
                <h6 aria-level="3" class="grid__product layout-{{ text_layout }}">
                    <h2 class="h3-reserve !block !text-black normal-case !mt-0 mb-[2px]">{{ product_title }}</h2>
                    <p class="p1 !block !text-black normal-case !mt-0 mb-[2px] sm:max-w-[164px] md:mb-0 md:max-w-none">{{ selected_variant.title }}</p>
                {% if product_subtext != blank %}
                    {% unless template contains 'collection' %}
                    <p class="product-subtext">{{ product_subtext }}</p>
                    {% endunless %}
                {% endif %}
                </h6>
                {% if last_order %}
                    <p class="label warranty-last-order mt-2">Last replacement order: {{ last_order | url_decode }}</p>
                {% endif %}
                {% if sold_out %}
                    <p class="p1">Sold Out</p>
                {% endif %}
            </div>
          <div class="md:relative md:ps-5">
            {% if cannot_replace %}
                <div class="warranty-cannot-replace max-w-56 grow-0"><p class="text-center text-rose-600 tracking-normal">{{ cannot_replace | url_decode }}</p>
            {% else %}
                <button
                {% if sold_out %}disabled {% endif %}
                id="quick-add-{{ product_id }}"
                type="button"
                class="quick-add whitespace-nowrap reserve-btn reserve-btn--outline-black !flex justify-center items-center w-full py-2 mt-[14px] sm:mt-[11px] md:mt-0 md:py-[10px]{% if in_cart %} pointer-events-none{% endif %}"
                {% if in_cart %}disabled="true"{% endif %}
                data-reserve-quick-add="true"
                data-variant-id="{{ selected_variant.id }}"
                onClick="handleClickQuickAdd(this, '{{ product_id }}', { '_replacement-order': '{{ order_number }}', '_replacement-item': '{{ product_id }}' });"
                >
                    {% if in_cart %}
                        Replacement added
                        <svg class="ml-2" xmlns="http://www.w3.org/2000/svg" width="18" height="13" fill="none">
                            <path stroke="#000" stroke-width="2" d="m1 5.75 5.5 5.5L17 .75"/>
                        </svg>
                    {% else %}
                        {% if sold_out %}Sold Out{% else %}Add Replacement | {{ product_price }}{% endif %}
                    {% endif %}
                </button>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
  </div>
  